---
# Credentials configuration for AAP Controller
# Defines credential types and credentials, using variables from my_lpar_v2_cfg.yml
# Load config: ansible-playbook -e @my_lpar_v2_cfg.yml ...
#
# Credential types (create these in AAP if not present):
# - Red Hat API Token (offline token for subscription/API access)
# - HMC (username/password for IBM Power HMC)
#
# Credentials reference variables from my_lpar_v2_cfg.yml:
#   offline_token, hmc_username, hmc_password

controller_credential_types:
  - name: "Red Hat API Token"
    description: "Credential for Red Hat API / subscription (offline token)"
    kind: cloud
    inputs:
      fields:
        - id: offline_token
          type: string
          label: "Red Hat API Token"
          secret: true
      required:
        - offline_token
    injectors:
      extra_vars:
        offline_token: !unsafe "{{ offline_token }}"

  - name: "HMC Credential"
    description: "Credential for IBM Power HMC access"
    kind: cloud
    inputs:
      fields:
        - id: hmc_username
          type: string
          label: "HMC Username"
        - id: hmc_password
          type: string
          label: "HMC Password"
          secret: true
      required:
        - hmc_username
        - hmc_password
    injectors:
      extra_vars:
        hmc_username: !unsafe "{{ hmc_username }}"
        hmc_password: !unsafe "{{ hmc_password }}"
      env:
        HMC_USERNAME: !unsafe "{{ hmc_username }}"
        HMC_PASSWORD: !unsafe "{{ hmc_password }}"

controller_credentials:
  - name: "Red Hat offline token"
    description: "Red Hat API Access for downloading RHEL media"
    organization: "sap"
    credential_type: "Red Hat API Token"
    inputs:
      offline_token: "{{ offline_token }}"

  - name: "HMC Credential"
    description: "IBM Power HMC access"
    organization: "sap"
    credential_type: "HMC Credential"
    inputs:
      hmc_username: "{{ hmc_username }}"
      hmc_password: "{{ hmc_password }}"

  - name: "Manage DHCP and Kickstart servers"
    description: "Machine Credential for accessing DHCP and Kickstart servers via SSH"
    organization: "sap"
    credential_type: "Machine"
    inputs:
      username: "root"
      # Pfad mit HOME expandieren – ~ wird in lookup('file') oft nicht aufgelöst
      ssh_key_data: "{{ lookup('file', lookup('env', 'HOME') + '/.ssh/id_coe') }}"
      ssh_key_unlock: ""

  - name: "Manage IBM LPAR servers"
    description: "manage LPARs via SSH"
    organization: "sap"
    credential_type: "Machine"
    inputs:
      username: admin
      ssh_key_data: "{{ lookup('file', lookup('env', 'HOME') + '/.ssh/id_coe') }}"
      ssh_key_unlock: ""
